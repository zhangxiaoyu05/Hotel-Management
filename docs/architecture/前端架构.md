# 前端架构

## 组件架构

### 组件组织

```
src/
├── components/           # 通用组件
│   ├── common/          # 基础组件
│   │   ├── Button/
│   │   ├── Input/
│   │   ├── Modal/
│   │   └── Loading/
│   ├── business/        # 业务组件
│   │   ├── RoomCard/
│   │   ├── OrderStatus/
│   │   └── RatingStars/
│   └── layout/          # 布局组件
│       ├── Header/
│       ├── Sidebar/
│       └── Footer/
├── pages/               # 页面组件
│   ├── auth/           # 认证页面
│   ├── hotels/         # 酒店相关页面
│   ├── rooms/          # 房间相关页面
│   ├── orders/         # 订单相关页面
│   ├── reviews/        # 评价相关页面
│   └── admin/          # 管理后台页面
├── hooks/              # 自定义 Hooks
├── services/           # API 服务
├── stores/             # Pinia 状态管理
├── utils/              # 工具函数
├── types/              # TypeScript 类型定义
└── styles/             # 全局样式
```

### 组件模板

```vue
<template>
  <div class="room-card" :class="{ 'room-card--loading': loading }">
    <div class="room-card__image">
      <img :src="room.images[0]" :alt="room.roomNumber" />
      <div class="room-card__status" :class="`room-card__status--${room.status.toLowerCase()}`">
        {{ getStatusText(room.status) }}
      </div>
    </div>

    <div class="room-card__content">
      <h3 class="room-card__title">{{ room.roomNumber }} - {{ room.roomTypeName }}</h3>
      <p class="room-card__info">楼层: {{ room.floor }} | 面积: {{ room.area }}㎡</p>
      <div class="room-card__facilities">
        <span v-for="facility in room.facilities" :key="facility" class="facility-tag">
          {{ facility }}
        </span>
      </div>

      <div class="room-card__footer">
        <div class="room-card__price">
          <span class="price-label">¥</span>
          <span class="price-value">{{ room.price }}</span>
          <span class="price-unit">/晚</span>
        </div>
        <el-button
          type="primary"
          :disabled="room.status !== 'AVAILABLE'"
          @click="handleBookRoom"
        >
          {{ room.status === 'AVAILABLE' ? '立即预订' : '不可预订' }}
        </el-button>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import type { Room } from '@/types/room';
import { useRoomStore } from '@/stores/room';

interface Props {
  room: Room;
  loading?: boolean;
}

interface Emits {
  (e: 'book', room: Room): void;
}

const props = withDefaults(defineProps<Props>(), {
  loading: false,
});

const emit = defineEmits<Emits>();

const roomStore = useRoomStore();

const getStatusText = (status: string) => {
  const statusMap = {
    AVAILABLE: '可预订',
    OCCUPIED: '已入住',
    MAINTENANCE: '维护中',
    CLEANING: '清洁中',
  };
  return statusMap[status] || status;
};

const handleBookRoom = () => {
  if (props.room.status === 'AVAILABLE') {
    emit('book', props.room);
  }
};
</script>

<style scoped lang="scss">
.room-card {
  border: 1px solid var(--border-color);
  border-radius: 8px;
  overflow: hidden;
  transition: all 0.3s ease;

  &:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
  }

  &--loading {
    opacity: 0.6;
    pointer-events: none;
  }

  &__image {
    position: relative;
    height: 200px;

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  &__status {
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;

    &--available {
      background-color: var(--success-color);
      color: white;
    }

    &--occupied {
      background-color: var(--error-color);
      color: white;
    }

    &--maintenance {
      background-color: var(--warning-color);
      color: white;
    }

    &--cleaning {
      background-color: var(--info-color);
      color: white;
    }
  }

  &__content {
    padding: 16px;
  }

  &__title {
    margin: 0 0 8px;
    font-size: 18px;
    font-weight: 600;
  }

  &__info {
    margin: 0 0 12px;
    color: var(--text-secondary);
  }

  &__facilities {
    margin-bottom: 16px;

    .facility-tag {
      display: inline-block;
      padding: 2px 8px;
      margin: 0 4px 4px 0;
      background-color: var(--bg-secondary);
      border-radius: 12px;
      font-size: 12px;
    }
  }

  &__footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  &__price {
    .price-label {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .price-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
    }

    .price-unit {
      font-size: 14px;
      color: var(--text-secondary);
    }
  }
}
</style>
```

## 状态管理架构

### 状态结构

```typescript
// stores/auth.ts
export const useAuthStore = defineStore('auth', () => {
  const user = ref<User | null>(null);
  const token = ref<string>('');
  const isAuthenticated = computed(() => !!token.value);
  const isAdmin = computed(() => user.value?.role === 'ADMIN');

  const login = async (credentials: LoginRequest) => {
    const response = await authService.login(credentials);
    token.value = response.token;
    user.value = response.user;
    localStorage.setItem('token', response.token);
  };

  const logout = () => {
    token.value = '';
    user.value = null;
    localStorage.removeItem('token');
  };

  const checkAuth = async () => {
    const storedToken = localStorage.getItem('token');
    if (storedToken) {
      token.value = storedToken;
      try {
        user.value = await authService.getCurrentUser();
      } catch (error) {
        logout();
      }
    }
  };

  return {
    user: readonly(user),
    token: readonly(token),
    isAuthenticated,
    isAdmin,
    login,
    logout,
    checkAuth,
  };
});

// stores/room.ts
export const useRoomStore = defineStore('room', () => {
  const rooms = ref<Room[]>([]);
  const currentRoom = ref<Room | null>(null);
  const searchFilters = ref<RoomSearchFilters>({
    checkInDate: '',
    checkOutDate: '',
    guestCount: 1,
    hotelId: undefined,
    roomTypeId: undefined,
    priceMin: undefined,
    priceMax: undefined,
  });
  const loading = ref(false);
  const error = ref<string>('');

  const searchRooms = async (filters: RoomSearchFilters) => {
    loading.value = true;
    error.value = '';
    try {
      const response = await roomService.searchRooms(filters);
      rooms.value = response.rooms;
      searchFilters.value = { ...filters };
    } catch (err) {
      error.value = err instanceof Error ? err.message : '搜索失败';
      rooms.value = [];
    } finally {
      loading.value = false;
    }
  };

  const getRoomById = async (id: number) => {
    loading.value = true;
    try {
      const room = await roomService.getRoomById(id);
      currentRoom.value = room;
    } catch (err) {
      error.value = err instanceof Error ? err.message : '获取房间信息失败';
    } finally {
      loading.value = false;
    }
  };

  return {
    rooms: readonly(rooms),
    currentRoom: readonly(currentRoom),
    searchFilters: readonly(searchFilters),
    loading: readonly(loading),
    error: readonly(error),
    searchRooms,
    getRoomById,
  };
});
```

## 路由架构

### 路由组织

```typescript
// router/index.ts
const routes = [
  {
    path: '/',
    redirect: '/home',
  },
  {
    path: '/auth',
    component: () => import('@/layouts/AuthLayout.vue'),
    children: [
      {
        path: 'login',
        name: 'Login',
        component: () => import('@/pages/auth/Login.vue'),
        meta: { title: '登录' },
      },
      {
        path: 'register',
        name: 'Register',
        component: () => import('@/pages/auth/Register.vue'),
        meta: { title: '注册' },
      },
    ],
  },
  {
    path: '/',
    component: () => import('@/layouts/MainLayout.vue'),
    meta: { requiresAuth: true },
    children: [
      {
        path: 'home',
        name: 'Home',
        component: () => import('@/pages/Home.vue'),
        meta: { title: '首页' },
      },
      {
        path: 'hotels',
        name: 'Hotels',
        component: () => import('@/pages/hotels/HotelList.vue'),
        meta: { title: '酒店列表' },
      },
      {
        path: 'hotels/:id',
        name: 'HotelDetail',
        component: () => import('@/pages/hotels/HotelDetail.vue'),
        meta: { title: '酒店详情' },
      },
      {
        path: 'rooms/search',
        name: 'RoomSearch',
        component: () => import('@/pages/rooms/RoomSearch.vue'),
        meta: { title: '房间搜索' },
      },
      {
        path: 'orders',
        name: 'Orders',
        component: () => import('@/pages/orders/OrderList.vue'),
        meta: { title: '我的订单', requiresAuth: true },
      },
      {
        path: 'orders/:id',
        name: 'OrderDetail',
        component: () => import('@/pages/orders/OrderDetail.vue'),
        meta: { title: '订单详情', requiresAuth: true },
      },
      {
        path: 'profile',
        name: 'Profile',
        component: () => import('@/pages/profile/Profile.vue'),
        meta: { title: '个人中心', requiresAuth: true },
      },
    ],
  },
  {
    path: '/admin',
    component: () => import('@/layouts/AdminLayout.vue'),
    meta: { requiresAuth: true, requiresAdmin: true },
    children: [
      {
        path: 'dashboard',
        name: 'AdminDashboard',
        component: () => import('@/pages/admin/Dashboard.vue'),
        meta: { title: '仪表板' },
      },
      {
        path: 'hotels',
        name: 'AdminHotels',
        component: () => import('@/pages/admin/hotels/HotelManagement.vue'),
        meta: { title: '酒店管理' },
      },
      {
        path: 'rooms',
        name: 'AdminRooms',
        component: () => import('@/pages/admin/rooms/RoomManagement.vue'),
        meta: { title: '房间管理' },
      },
      {
        path: 'orders',
        name: 'AdminOrders',
        component: () => import('@/pages/admin/orders/OrderManagement.vue'),
        meta: { title: '订单管理' },
      },
      {
        path: 'users',
        name: 'AdminUsers',
        component: () => import('@/pages/admin/users/UserManagement.vue'),
        meta: { title: '用户管理' },
      },
      {
        path: 'reviews',
        name: 'AdminReviews',
        component: () => import('@/pages/admin/reviews/ReviewManagement.vue'),
        meta: { title: '评价管理' },
      },
    ],
  },
  {
    path: '/:pathMatch(.*)*',
    name: 'NotFound',
    component: () => import('@/pages/NotFound.vue'),
    meta: { title: '页面不存在' },
  },
];
```

### 受保护路由模式

```typescript
// router/guards.ts
router.beforeEach(async (to, from, next) => {
  const authStore = useAuthStore();

  // 检查是否需要认证
  if (to.meta.requiresAuth) {
    if (!authStore.isAuthenticated) {
      // 重定向到登录页面
      next({
        name: 'Login',
        query: { redirect: to.fullPath },
      });
      return;
    }

    // 检查是否需要管理员权限
    if (to.meta.requiresAdmin && !authStore.isAdmin) {
      next({ name: 'Home' });
      return;
    }
  }

  // 设置页面标题
  if (to.meta.title) {
    document.title = `${to.meta.title} - 成都酒店管理系统`;
  }

  next();
});
```

## 前端服务层

### API客户端设置

```typescript
// services/api.ts
import axios, { AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios';
import { useAuthStore } from '@/stores/auth';
import { ElMessage } from 'element-plus';

class ApiClient {
  private instance: AxiosInstance;

  constructor() {
    this.instance = axios.create({
      baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080/v1',
      timeout: 10000,
      headers: {
        'Content-Type': 'application/json',
      },
    });

    this.setupInterceptors();
  }

  private setupInterceptors() {
    // 请求拦截器
    this.instance.interceptors.request.use(
      (config) => {
        const authStore = useAuthStore();
        if (authStore.token) {
          config.headers.Authorization = `Bearer ${authStore.token}`;
        }
        return config;
      },
      (error) => {
        return Promise.reject(error);
      }
    );

    // 响应拦截器
    this.instance.interceptors.response.use(
      (response: AxiosResponse) => {
        return response;
      },
      (error) => {
        if (error.response?.status === 401) {
          const authStore = useAuthStore();
          authStore.logout();
          window.location.href = '/auth/login';
        } else if (error.response?.data?.error?.message) {
          ElMessage.error(error.response.data.error.message);
        } else {
          ElMessage.error('请求失败，请稍后重试');
        }
        return Promise.reject(error);
      }
    );
  }

  public get<T = any>(url: string, config?: AxiosRequestConfig): Promise<T> {
    return this.instance.get(url, config).then(response => response.data);
  }

  public post<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return this.instance.post(url, data, config).then(response => response.data);
  }

  public put<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return this.instance.put(url, data, config).then(response => response.data);
  }

  public delete<T = any>(url: string, config?: AxiosRequestConfig): Promise<T> {
    return this.instance.delete(url, config).then(response => response.data);
  }
}

export const apiClient = new ApiClient();
```

### 服务示例

```typescript
// services/roomService.ts
import { apiClient } from './api';
import type { Room, RoomSearchRequest, RoomSearchResponse } from '@/types/room';

export const roomService = {
  async searchRooms(filters: RoomSearchRequest): Promise<RoomSearchResponse> {
    return apiClient.post<RoomSearchResponse>('/rooms/search', filters);
  },

  async getRoomById(id: number): Promise<Room> {
    return apiClient.get<Room>(`/rooms/${id}`);
  },

  async getHotelRooms(hotelId: number, filters?: any): Promise<{ rooms: Room[]; total: number }> {
    const params = new URLSearchParams(filters);
    return apiClient.get<{ rooms: Room[]; total: number }>(`/hotels/${hotelId}/rooms?${params}`);
  },

  async updateRoomStatus(id: number, status: string): Promise<Room> {
    return apiClient.put<Room>(`/rooms/${id}`, { status });
  },
};
```
