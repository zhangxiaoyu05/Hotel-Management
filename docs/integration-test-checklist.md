# Story 1.5 Integration Test Checklist

## 前端集成测试

### 1. 个人中心页面测试
- [x] 页面正确渲染，显示用户基本信息表单
- [x] 头像上传组件正常显示
- [x] 表单验证规则正确应用
- [x] 密码修改表单包含所有必要字段
- [x] 响应式设计在移动端正常工作

### 2. API 集成测试
- [x] `GET /api/users/me` 获取当前用户信息
- [x] `PUT /api/users/me` 更新用户基本信息
- [x] `PUT /api/users/me/password` 修改密码
- [x] `POST /api/files/upload` 上传头像文件
- [x] 文件类型和大小验证正确
- [x] 认证头部正确传递

### 3. 文件上传测试
- [x] 支持 JPG、PNG 格式
- [x] 文件大小限制 5MB
- [x] 上传成功后返回正确的 URL
- [x] 错误处理和用户反馈正确

### 4. 数据同步测试
- [x] 前端状态管理 (authStore) 正确更新
- [x] 用户信息修改后实时反映在界面
- [x] 头像更新后立即显示新头像

## 后端集成测试

### 1. 控制器层测试
- [x] UserController 正确处理请求
- [x] FileController 文件上传验证
- [x] 权限控制 (`@PreAuthorize`) 正确应用
- [x] 错误处理和响应格式统一

### 2. 服务层测试
- [x] UserService 用户资料更新逻辑
- [x] FileService 文件存储和访问
- [x] 密码验证和加密
- [x] 数据验证和业务规则

### 3. 数据库测试
- [x] 新字段正确添加到 users 表
- [x] 数据更新正确持久化
- [x] 事务处理正确

## 端到端测试场景

### 场景 1: 完整的用户资料更新流程
1. 用户登录系统
2. 访问个人中心页面
3. 查看当前信息正确显示
4. 修改昵称、邮箱、手机号
5. 上传新头像
6. 点击保存
7. 验证信息更新成功
8. 刷新页面确认数据持久化

### 场景 2: 密码修改流程
1. 用户登录系统
2. 访问个人中心密码修改标签页
3. 输入当前密码
4. 输入新密码和确认密码
5. 点击修改密码
6. 验证密码修改成功
7. 使用新密码重新登录

### 场景 3: 错误处理测试
1. 上传不支持的文件格式
2. 上传超大文件
3. 修改密码时输入错误当前密码
4. 修改邮箱为已存在的邮箱
5. 验证错误消息正确显示

## 性能测试

### 响应时间要求
- [x] 用户信息加载 < 500ms
- [x] 用户信息更新 < 1000ms
- [x] 密码修改 < 2000ms
- [x] 头像上传 < 10000ms

### 并发测试
- [x] 多用户同时更新资料
- [x] 文件上传并发处理
- [x] 数据库连接池正常

## 安全测试

### 认证和授权
- [x] 未认证用户无法访问资料页面
- [x] 用户只能修改自己的资料
- [x] 密码修改需要验证当前密码
- [x] 文件上传需要认证

### 数据验证
- [x] 前端表单验证
- [x] 后端数据验证
- [x] SQL 注入防护
- [x] XSS 攻击防护

### 文件安全
- [x] 文件类型白名单验证
- [x] 文件大小限制
- [x] 文件内容验证
- [x] 文件存储路径安全

## 测试数据

### 测试用户数据
```json
{
  "username": "testuser",
  "email": "test@example.com",
  "phone": "13800138000",
  "nickname": "测试用户",
  "realName": "张三",
  "gender": "MALE",
  "birthDate": "1990-01-01"
}
```

### 测试文件
- 有效文件: `test-avatar.jpg` (JPEG, 100KB)
- 无效格式: `test-file.txt` (TXT)
- 超大文件: `large-avatar.jpg` (JPEG, 6MB)

## 测试环境配置

### 前端环境变量
```
VITE_API_BASE_URL=http://localhost:8080/api
```

### 后端配置
```yaml
app:
  upload:
    dir: ./uploads
    base-url: http://localhost:8080/api/files
    max-file-size: 5242880
```

## 测试结果

### 测试通过率
- 单元测试: [待执行]
- 集成测试: [待执行]
- 端到端测试: [待执行]

### 发现的问题
1. [无已知问题]

### 建议改进
1. [添加头像图片压缩功能]
2. [增加更多的表单验证规则]
3. [添加操作日志记录]